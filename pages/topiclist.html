<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯é¢˜åˆ—è¡¨ - æ•™å¸ˆè§†é¢‘ä¿±ä¹éƒ¨</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* é‡ç½®å’ŒåŸºç¡€æ ·å¼ */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
            min-height: 100vh;
        }

        /* é¡µé¢å®¹å™¨ - ä¿®æ”¹ä¸º100%å®½åº¦ */
        .topic-page-container {
            width: 100%;
            max-width: none;
            margin: 0;
            padding: 0;
            min-height: calc(100vh - 60px); /* å‡å»headeré«˜åº¦ */
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .topic-main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        /* é¡µé¢æ ‡é¢˜åŒºåŸŸ - æ‰©å¤§ */
        .page-title-section {
            margin-bottom: 32px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 16px;
            padding: 40px 48px;
            text-align: left;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .page-title-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3));
        }

        .page-title-section h2 {
            font-size: 36px;
            color: #1a1a1a;
            margin: 0 0 16px 0;
            font-weight: 800;
            line-height: 1.2;
        }

        .page-title-section p {
            font-size: 18px;
            color: #4a5568;
            margin: 0;
            font-weight: 500;
            max-width: 800px;
        }

        /* è¯é¢˜æç¤ºæ ·å¼ */
        .topic-notice {
            display: inline;
            margin-left: 12px;
            padding: 4px 12px;
            background: #f7f7f7;
            border-radius: 4px;
            font-size: 14px;
            color: #8c8c8c;
            line-height: 1.5;
        }

        .topic-notice strong {
            color: #d4380d;
            font-weight: 600;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            color: #4a5568;
            padding: 12px 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
        }

        /* æ“ä½œæ  - æ‰©å¤§ */
        .topic-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding: 24px 32px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .topic-stats {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            color: #4a5568;
            padding: 12px 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
        }

        .stat-item i {
            color: #1890ff;
            font-size: 20px;
        }

        .stat-number {
            font-weight: 700;
            color: #1a1a1a;
            font-size: 20px;
            margin-left: 4px;
        }

        /* åˆ›å»ºè¯é¢˜æŒ‰é’®ï¼ˆheaderç‰ˆæœ¬ï¼‰ */
        .btn-create-topic-header {
            background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(24, 144, 255, 0.25);
        }

        .btn-create-topic-header:hover {
            background: linear-gradient(135deg, #40a9ff 0%, #1890ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(24, 144, 255, 0.35);
        }

        .btn-create-topic-header i {
            font-size: 16px;
        }

        /* è¯é¢˜åˆ—è¡¨ */
        .topic-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(600px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        /* è¯é¢˜å¡ç‰‡ - æ‰©å¤§ */
        .topic-card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* ç½®é¡¶è¯é¢˜å¡ç‰‡ */
        .topic-card.pinned {
            background: linear-gradient(135deg, #fefefe 0%, #fafafa 100%);
            border: 2px solid #ffd591;
            box-shadow: 0 4px 20px rgba(255, 213, 145, 0.15);
        }

        .topic-card.pinned::before {
            background: linear-gradient(180deg, #ffd591, #ffc069);
        }

        /* å¿…ç­”æ ‡ç­¾ */
        .topic-badge.required {
            background: linear-gradient(135deg, #ff7875, #ffa39e);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 120, 117, 0.3);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(255, 120, 117, 0);
            }
        }

        /* ç½®é¡¶å›¾æ ‡ */
        .pin-icon {
            position: absolute;
            top: 16px;
            right: 16px;
            color: #ffc069;
            font-size: 18px;
            transform: rotate(45deg);
            opacity: 0.6;
        }

        .topic-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(180deg, #1890ff, #096dd9);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .topic-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            border-color: #ffc069;
        }

        .topic-card:hover::before {
            opacity: 1;
        }

        .topic-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex: 1;
        }

        .topic-main-info {
            flex: 1;
            cursor: pointer;
            min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
        }

        .topic-title-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .topic-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
            line-height: 1.3;
            word-break: break-word;
        }

        .topic-badge {
            background: linear-gradient(135deg, #52c41a, #73d13d);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
        }

        .topic-badge.hot {
            background: linear-gradient(135deg, #ff4d4f, #ff7875);
        }

        .topic-badge.new {
            background: linear-gradient(135deg, #1890ff, #40a9ff);
        }

        .topic-description {
            color: #4a5568;
            font-size: 16px;
            line-height: 1.6;
            margin: 12px 0 0 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-break: break-word;
        }

        .topic-description.empty {
            color: #94a3b8;
            font-style: italic;
        }

        /* è¯é¢˜å…ƒä¿¡æ¯ */
        .topic-meta {
            display: flex;
            gap: 24px;
            align-items: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #f1f5f9;
            flex-wrap: wrap;
        }

        .topic-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            color: #64748b;
            background: #f8fafc;
            padding: 8px 16px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .topic-meta-item i {
            color: #1890ff;
            font-size: 16px;
        }

        .topic-meta-item strong {
            color: #1a1a1a;
            font-weight: 600;
            margin-left: 4px;
        }

        /* è¯é¢˜æ“ä½œæŒ‰é’® */
        .topic-actions {
            display: flex;
            gap: 12px;
            flex-shrink: 0;
            margin-left: 20px;
        }

        .btn-topic-action {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-edit {
            background: linear-gradient(135deg, #e6f4ff, #bae0ff);
            color: #1890ff;
            border: 1px solid #91caff;
        }

        .btn-edit:hover {
            background: linear-gradient(135deg, #bae0ff, #91caff);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.2);
        }

        .btn-delete {
            background: linear-gradient(135deg, #fff1f0, #ffccc7);
            color: #ff4d4f;
            border: 1px solid #ffa39e;
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, #ffccc7, #ffa39e);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 77, 79, 0.2);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 100px 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 2px dashed #e2e8f0;
            margin: 40px 0;
        }

        .empty-state-icon {
            font-size: 100px;
            color: #cbd5e1;
            margin-bottom: 32px;
            opacity: 0.7;
        }

        .empty-state h3 {
            font-size: 28px;
            color: #475569;
            margin: 0 0 16px 0;
            font-weight: 700;
        }

        .empty-state p {
            font-size: 18px;
            color: #94a3b8;
            margin: 0 0 32px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            border: 1px solid #e2e8f0;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .modal-header h3 {
            margin: 0;
            color: #1a1a1a;
            font-size: 28px;
            font-weight: 800;
        }

        .btn-close {
            background: #f1f5f9;
            border: none;
            font-size: 20px;
            color: #64748b;
            cursor: pointer;
            padding: 8px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            background: #e2e8f0;
            color: #334155;
            transform: rotate(90deg);
        }

        /* è¡¨å• */
        .form-group {
            margin-bottom: 32px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            color: #334155;
            font-weight: 700;
            font-size: 16px;
        }

        .form-group label .required {
            color: #ff4d4f;
            margin-left: 4px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1890ff;
            background: white;
            box-shadow: 0 0 0 4px rgba(24, 144, 255, 0.1);
        }

        .form-group textarea {
            min-height: 160px;
            resize: vertical;
            line-height: 1.6;
        }

        .form-hint {
            font-size: 14px;
            color: #94a3b8;
            margin-top: 8px;
        }

        /* è¡¨å•æ“ä½œæŒ‰é’® */
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 40px;
        }

        .btn {
            padding: 14px 36px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
            color: #334155;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1890ff, #096dd9);
            color: white;
            box-shadow: 0 6px 20px rgba(24, 144, 255, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #40a9ff, #1890ff);
            transform: translateY(-2px);
            box-shadow: 0 10px 24px rgba(24, 144, 255, 0.4);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .topic-list {
                grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            }
            
            .topic-main-content {
                padding: 20px;
            }
        }

        @media (max-width: 1024px) {
            .page-title-section {
                padding: 32px 40px;
            }
            
            .page-title-section h2 {
                font-size: 32px;
            }
            
            .topic-toolbar {
                padding: 20px 28px;
            }
        }

        @media (max-width: 768px) {
            .topic-main-content {
                padding: 16px;
            }
            
            .page-title-section {
                padding: 24px;
                text-align: center;
            }
            
            .page-title-section h2 {
                font-size: 28px;
                margin-bottom: 12px;
            }
            
            .page-title-section p {
                font-size: 16px;
            }
            
            .topic-toolbar {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
                padding: 20px;
            }
            
            .topic-stats {
                justify-content: space-between;
                flex-wrap: wrap;
                gap: 16px;
            }
            
            .stat-item {
                padding: 10px 16px;
                font-size: 15px;
            }
            
            .btn-create-topic-header {
                width: 100%;
                justify-content: center;
            }
            
            .topic-list {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .topic-card {
                padding: 24px;
            }
            
            .topic-card-header {
                flex-direction: column;
                gap: 16px;
            }
            
            .topic-actions {
                margin-left: 0;
                width: 100%;
                justify-content: flex-end;
            }
            
            .topic-title {
                font-size: 22px;
            }
            
            .topic-description {
                font-size: 15px;
            }
            
            .topic-meta {
                gap: 12px;
            }
            
            .topic-meta-item {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            .modal-content {
                padding: 24px;
                border-radius: 20px;
            }
            
            .modal-header h3 {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            .page-title-section {
                padding: 20px;
            }
            
            .page-title-section h2 {
                font-size: 24px;
            }
            
            .topic-card {
                padding: 20px;
            }
            
            .topic-title {
                font-size: 20px;
            }
            
            .btn-topic-action {
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .topic-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .topic-meta-item {
                width: 100%;
                justify-content: space-between;
            }
            
            .empty-state {
                padding: 60px 20px;
            }
            
            .empty-state-icon {
                font-size: 80px;
            }
            
            .empty-state h3 {
                font-size: 24px;
            }
            
            .empty-state p {
                font-size: 16px;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 80px 20px;
        }

        .loading-spinner {
            width: 56px;
            height: 56px;
            border: 4px solid #f1f5f9;
            border-top-color: #1890ff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å¤´éƒ¨æ ·å¼è°ƒæ•´ */
        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .platform-name {
            font-size: 20px;
            font-weight: 700;
        }

        .user-info {
            padding: 8px 16px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .avatar {
            width: 36px;
            height: 36px;
            font-size: 16px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="page-topic-list" class="page active">
        <div class="header">
            <div class="header-left">
                <button class="btn btn-text" onclick="goBackToTasks()" style="margin-right:10px;">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <span class="platform-name">æ•™å¸ˆè§†é¢‘ä¿±ä¹éƒ¨</span>
                <span style="color: #999; font-weight: normal;"> | è¯é¢˜åˆ—è¡¨</span>
            </div>
            <div class="header-right">
                <button class="btn-create-topic-header" id="btnCreateTopic" style="display: none; margin-right: 20px;">
                    <i class="fas fa-plus-circle"></i>
                    <span>å‘èµ·æ–°è¯é¢˜</span>
                </button>
                <div class="user-info">
                    <div class="avatar" id="topic-user-avatar">ç‹</div>
                    <span id="topic-user-name">ç‹è€å¸ˆ</span>
                </div>
            </div>
        </div>
        
        <div class="topic-page-container">
            <div class="topic-main-content">
                <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
                <div class="page-title-section">
                    <h2 id="task-title">ğŸ“‹ è¯é¢˜åˆ—è¡¨</h2>
                    <p>åˆ†äº«è§‚ç‚¹ã€æ·±åº¦äº¤æµã€å…±åŒæˆé•¿</p>
                </div>

                <!-- æ“ä½œå·¥å…·æ  -->
<div class="topic-toolbar">
    <div class="topic-stats">
        <div class="stat-item">
            <i class="fas fa-comments"></i>
            <span>å…± <span class="stat-number" id="topicCount">0</span> ä¸ªè¯é¢˜</span>
            <span class="topic-notice">
                <strong>æç¤ºï¼š</strong>ä¿±ä¹éƒ¨åˆ›å»ºè€…å‘å¸ƒçš„è¯é¢˜ä¸ºå¿…ç­”ï¼Œå…¶ä»–æˆå‘˜å‘å¸ƒçš„ä¸»é¢˜å¯è‡ªç”±è®¨è®º
            </span>
        </div>
    </div>
</div>
                
                <!-- è¯é¢˜åˆ—è¡¨ -->
                <div class="topic-list" id="topicList">
                    <!-- è¯é¢˜å°†åŠ¨æ€åŠ è½½ -->
                </div>

                <!-- ç©ºçŠ¶æ€ -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3>è¿˜æ²¡æœ‰è¯é¢˜</h3>
                    <p id="emptyStateText">å¿«æ¥åˆ›å»ºç¬¬ä¸€ä¸ªè¯é¢˜ï¼Œå¼€å¯è®¨è®ºå§ï¼</p>
                </div>

                <!-- åŠ è½½çŠ¶æ€ -->
                <div class="loading-container" id="loadingState" style="display: none;">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»º/ç¼–è¾‘è¯é¢˜æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="topicModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">å‘èµ·æ–°è¯é¢˜</h3>
                <button class="btn-close" onclick="closeTopicModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="topicForm">
                <input type="hidden" id="editTopicId" value="">
                <div class="form-group">
                    <label for="topicTitle">
                        è¯é¢˜æ ‡é¢˜
                        <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="topicTitle" 
                        placeholder="ç”¨ä¸€å¥è¯æ¦‚æ‹¬ä½ æƒ³è®¨è®ºçš„ä¸»é¢˜" 
                        required 
                        maxlength="100">
                    <div class="form-hint">ç®€æ´æ˜äº†åœ°æè¿°è¯é¢˜ï¼Œé™100å­—</div>
                </div>
                <div class="form-group">
                    <label for="topicDescription">è¯é¢˜è¯´æ˜</label>
                    <textarea 
                        id="topicDescription" 
                        placeholder="è¯¦ç»†è¯´æ˜è¿™ä¸ªè¯é¢˜çš„è®¨è®ºæ–¹å‘ã€è¦æ±‚æˆ–èƒŒæ™¯ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰"
                        maxlength="500"></textarea>
                    <div class="form-hint">ä¸ºå‚ä¸è€…æä¾›æ›´å¤šè®¨è®ºèƒŒæ™¯ï¼Œé™500å­—</div>
                </div>
                <div class="form-group">
                    <label for="topicScaffold">
                        å›ç­”æ”¯æ¶ï¼ˆé€‰å¡«ï¼‰
                        <span style="color: #8c8c8c; font-weight: 400; font-size: 14px; margin-left: 8px;">ä¸ºè®¨è®ºè€…æä¾›å›ç­”æ¡†æ¶</span>
                    </label>
                    <textarea 
                        id="topicScaffold" 
                        placeholder="ä¾‹å¦‚ï¼š&#10;1. èšç„¦è§‚å¯Ÿï¼Œè¯†åˆ«å…³é”®äº‹ä»¶ï¼šè¯·æè¿°ä½ åœ¨æ•™å­¦è§†é¢‘ä¸­æ³¨æ„åˆ°çš„1-2ä¸ªå…³é”®æ•™å­¦ç‰‡æ®µï¼ˆä¾‹å¦‚æ•™å¸ˆçš„æŸä¸ªæé—®ã€æŸæ¬¡äº’åŠ¨ã€æŸä¸ªè¿‡æ¸¡ç¯èŠ‚ç­‰ï¼‰ã€‚ä¸ºä»€ä¹ˆè¿™äº›ç‰‡æ®µå¼•èµ·äº†ä½ çš„æ³¨æ„ï¼Ÿ&#10;&#10;2. å¯¹æ¯”åˆ†æï¼Œæ¯”è¾ƒæ„å›¾ä¸è¡Œä¸ºï¼šæ•™å¸ˆåœ¨æ•™å­¦è®¾è®¡/è¯´è¯¾ä¸­é˜è¿°çš„è®¾è®¡æ„å›¾ï¼Œä¸ä½ åœ¨æ•™å­¦è§†é¢‘ä¸­è§‚å¯Ÿåˆ°çš„å®é™…å®æ–½æƒ…å†µæ˜¯å¦ä¸€è‡´ï¼Ÿæœ‰å“ªäº›å·®è·æˆ–æ„å¤–ï¼Ÿäº§ç”Ÿè¿™ç§å·®è·çš„åŸå› å¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ&#10;&#10;3. ä»åæ€åˆ°è¡ŒåŠ¨ï¼šé€šè¿‡è¿™æ¬¡è§‚è¯¾ï¼Œä½ å¯¹"å¥½çš„æ•™å­¦"çš„ç†è§£æœ‰ä»€ä¹ˆæ–°çš„è®¤è¯†æˆ–å˜åŒ–ï¼Ÿä½ æ‰“ç®—åœ¨è‡ªå·±æœªæ¥çš„æ•™å­¦å®è·µä¸­å°è¯•ä»€ä¹ˆå…·ä½“çš„è¡ŒåŠ¨ï¼Ÿ"
                        maxlength="2000"
                        rows="8"></textarea>
                    <div class="form-hint">å¯é€‰å¡«ã€‚å¦‚æœå¡«å†™ï¼Œå‚ä¸è€…å°†ä½¿ç”¨æ‚¨æä¾›çš„æ¡†æ¶è¿›è¡Œå›ç­”ï¼Œæ— éœ€é‡å¤è¾“å…¥é—®é¢˜ã€‚é™2000å­—</div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTopicModal()">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="btn btn-primary">
                        å‘å¸ƒè¯é¢˜
                    </button>
                </div>
            </form>
        </div>
    </div>

<script>
    // ========== é¡µé¢çŠ¶æ€ ==========
    let currentTaskId = null;
    let currentClubId = null;
    let currentUserId = null;
    let isClubAdmin = false;
    let clubCreatorId = null; // æ–°å¢ï¼šä¿å­˜ä¿±ä¹éƒ¨åˆ›å»ºè€…ID
    let topicList = [];

    // ========== é¡µé¢åˆå§‹åŒ– ==========
    async function initTopicListPage() {
        console.log('è¯é¢˜åˆ—è¡¨é¡µé¢åˆå§‹åŒ–');
        
        // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
        updateUserDisplay();
        
        // è·å–ä»»åŠ¡ID
        currentTaskId = getTaskIdFromURL();
        currentClubId = getClubIdFromURL();
        
        if (!currentTaskId) {
            showMessage('æ— æ³•è·å–ä»»åŠ¡ä¿¡æ¯', 'error');
            goBackToTasks();
            return;
        }

        if (window.Utils && Utils.sendAnalyticsEvent) {
            Utils.sendAnalyticsEvent('topic_open_list', {
                category: 'interaction',
                target_type: 'task',
                target_id: currentTaskId,
                club_id: currentClubId
            });
        }

        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        if (window.Auth && window.Auth.getUser()) {
            const user = window.Auth.getUser();
            currentUserId = user.id || user.userId;
        }

        // æ£€æŸ¥æ˜¯å¦æ˜¯ä¿±ä¹éƒ¨ç®¡ç†å‘˜
        await checkAdminStatus();
        
        // åŠ è½½è¯é¢˜åˆ—è¡¨
        await loadTopics();
    }

    document.addEventListener('DOMContentLoaded', initTopicListPage);

    // ========== æ›´æ–°ç”¨æˆ·æ˜¾ç¤º ==========
    function updateUserDisplay() {
        if (window.Auth && window.Auth.getUser()) {
            const user = window.Auth.getUser();
            document.getElementById('topic-user-avatar').textContent = user.name.charAt(0);
            document.getElementById('topic-user-name').textContent = user.name;
        }
    }

    // ========== è·å–ä»»åŠ¡ID ==========
    function getTaskIdFromURL() {
        const hash = window.location.hash;
        const params = new URLSearchParams(hash.split('?')[1]);
        return params.get('taskId') ? parseInt(params.get('taskId')) : null;
    }

    // ========== è·å–ä¿±ä¹éƒ¨ID ==========
    function getClubIdFromURL() {
        const hash = window.location.hash;
        const params = new URLSearchParams(hash.split('?')[1]);
        return params.get('clubId') ? parseInt(params.get('clubId')) : null;
    }

    // ========== æ£€æŸ¥ç®¡ç†å‘˜æƒé™ ==========
    async function checkAdminStatus() {
        try {
            console.log('å¼€å§‹æ£€æŸ¥ç®¡ç†å‘˜æƒé™');
            console.log('currentClubId:', currentClubId);
            console.log('currentUserId:', currentUserId);
            
            if (!currentClubId) {
                console.warn('ç¼ºå°‘ä¿±ä¹éƒ¨IDï¼Œæ— æ³•æ£€æŸ¥æƒé™');
                isClubAdmin = false;
                // æ‰€æœ‰äººéƒ½å¯ä»¥åˆ›å»ºè¯é¢˜
                document.getElementById('btnCreateTopic').style.display = 'flex';
                return;
            }

            // ä½¿ç”¨Clubs.isClubCreator()æ–¹æ³•æ£€æŸ¥æƒé™ï¼ˆä¸video.htmlä¸€è‡´ï¼‰
            if (!window.Clubs || !Clubs.isClubCreator) {
                console.warn('Clubsæ¨¡å—æœªåŠ è½½');
                isClubAdmin = false;
                // æ‰€æœ‰äººéƒ½å¯ä»¥åˆ›å»ºè¯é¢˜
                document.getElementById('btnCreateTopic').style.display = 'flex';
                return;
            }

            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯ä¿±ä¹éƒ¨åˆ›å»ºè€…ï¼ˆè§’è‰²ä¸ºmanagerï¼‰
            isClubAdmin = await Clubs.isClubCreator(currentClubId);
            console.log('æƒé™æ£€æŸ¥ç»“æœ - æ˜¯å¦æ˜¯åˆ›å»ºè€…:', isClubAdmin);
            
            // è·å–ä¿±ä¹éƒ¨è¯¦æƒ…ä»¥è·å–åˆ›å»ºè€…ID
            try {
                const clubDetail = await Clubs.getClubDetail(currentClubId);
                if (clubDetail && clubDetail.creator) {
                    clubCreatorId = clubDetail.creator.userId || clubDetail.creatorId;
                    console.log('ä¿±ä¹éƒ¨åˆ›å»ºè€…ID:', clubCreatorId);
                }
            } catch (error) {
                console.error('è·å–ä¿±ä¹éƒ¨åˆ›å»ºè€…IDå¤±è´¥:', error);
            }
            
            // æ‰€æœ‰äººéƒ½å¯ä»¥åˆ›å»ºè¯é¢˜
            document.getElementById('btnCreateTopic').style.display = 'flex';
            document.getElementById('emptyStateText').textContent = 'è¿˜æ²¡æœ‰è¯é¢˜ï¼Œç‚¹å‡»å³ä¸Šè§’æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªè¯é¢˜å§ï¼';
        } catch (error) {
            console.error('æ£€æŸ¥ç®¡ç†å‘˜æƒé™å¤±è´¥:', error);
            isClubAdmin = false;
            // å³ä½¿å‡ºé”™ï¼Œä¹Ÿå…è®¸æ‰€æœ‰äººåˆ›å»ºè¯é¢˜
            document.getElementById('btnCreateTopic').style.display = 'flex';
        }
    }

    // ========== åŠ è½½è¯é¢˜åˆ—è¡¨ ==========
    // ========== åŠ è½½è¯é¢˜åˆ—è¡¨ ==========
async function loadTopics() {
    try {
        console.log('[DEBUG] ğŸ“‹ å¼€å§‹åŠ è½½è¯é¢˜åˆ—è¡¨');
        console.log('[DEBUG] ğŸ“‹ å½“å‰ä»»åŠ¡ID:', currentTaskId);
        
        const loadingState = document.getElementById('loadingState');
        const topicListEl = document.getElementById('topicList');
        const emptyState = document.getElementById('emptyState');
        
        loadingState.style.display = 'flex';
        topicListEl.style.display = 'none';
        emptyState.style.display = 'none';

        if (!window.Topics || !Topics.getTopics) {
            throw new Error('è¯é¢˜æ¨¡å—æœªåŠ è½½');
        }

        console.log('[DEBUG] ğŸ“¤ è°ƒç”¨ Topics.getTopics()');
        
        // â­â­â­ å…³é”®ä¿®å¤ï¼šç¡®ä¿æ›´æ–°å…¨å±€å˜é‡
        const newTopics = await Topics.getTopics(currentTaskId);
        
        console.log('[DEBUG] ğŸ“¥ APIè¿”å›è¯é¢˜æ•°é‡:', newTopics.length);
        console.log('[DEBUG] ğŸ“¥ æ–°è¯é¢˜åˆ—è¡¨:', newTopics.map(t => ({
            id: t.topicId,
            title: t.title,
            deleted: t.deleted
        })));
        
        // â­â­â­ æ›´æ–°å…¨å±€å˜é‡
        topicList = newTopics;
        
        console.log('[DEBUG] ğŸ“‹ å…¨å±€ topicList å·²æ›´æ–°ï¼Œæ•°é‡:', topicList.length);
        
        loadingState.style.display = 'none';
        displayTopics(topicList);  // ä¼ å…¥æ­£ç¡®çš„æ•°æ®
        
        console.log('[DEBUG] âœ… è¯é¢˜åˆ—è¡¨åŠ è½½å®Œæˆ');
        
    } catch (error) {
        console.error('[DEBUG] âŒ åŠ è½½è¯é¢˜åˆ—è¡¨å¤±è´¥:', error);
        console.error('[DEBUG] âŒ é”™è¯¯å †æ ˆ:', error.stack);
        document.getElementById('loadingState').style.display = 'none';
        showMessage('åŠ è½½è¯é¢˜å¤±è´¥: ' + error.message, 'error');
    }
}
    // ========== æ˜¾ç¤ºè¯é¢˜åˆ—è¡¨ ==========
    function displayTopics(topics) {
        const topicListEl = document.getElementById('topicList');
        const emptyState = document.getElementById('emptyState');
        const topicCount = document.getElementById('topicCount');
        const hotTopicCount = document.getElementById('hotTopicCount');

        topicCount.textContent = topics.length;
        

        if (!topics || topics.length === 0) {
            topicListEl.innerHTML = '';
            topicListEl.style.display = 'none';
            emptyState.style.display = 'block';
            return;
        }

        emptyState.style.display = 'none';
        topicListEl.style.display = 'grid';
        
        // å¯¹è¯é¢˜è¿›è¡Œæ’åºï¼šä¿±ä¹éƒ¨åˆ›å»ºè€…çš„è¯é¢˜ç½®é¡¶
        const sortedTopics = [...topics].sort((a, b) => {
            const aIsCreator = clubCreatorId && a.creatorId === clubCreatorId;
            const bIsCreator = clubCreatorId && b.creatorId === clubCreatorId;
            
            // ä¿±ä¹éƒ¨åˆ›å»ºè€…çš„è¯é¢˜æ’åœ¨å‰é¢
            if (aIsCreator && !bIsCreator) return -1;
            if (!aIsCreator && bIsCreator) return 1;
            
            // å…¶ä»–è¯é¢˜æŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼ˆæ–°çš„åœ¨å‰ï¼‰
            return new Date(b.createdAt) - new Date(a.createdAt);
        });
        
        topicListEl.innerHTML = sortedTopics.map((topic, index) => {
            const isHot = (topic.commentCount || 0) > 10;
            const isMyTopic = topic.creatorId === currentUserId;
            const canManage = isClubAdmin || isMyTopic;
            const isCreatorTopic = clubCreatorId && topic.creatorId === clubCreatorId; // æ˜¯å¦æ˜¯ä¿±ä¹éƒ¨åˆ›å»ºè€…å‘å¸ƒçš„è¯é¢˜
            const isFirstNonCreatorTopic = !isCreatorTopic && sortedTopics.slice(0, index).every(t => clubCreatorId && t.creatorId === clubCreatorId);
            
            return `
                <div class="topic-card ${isCreatorTopic ? 'pinned' : ''}">
                    ${isCreatorTopic ? '<i class="fas fa-thumbtack pin-icon"></i>' : ''}
                    <div class="topic-card-header">
                        <div class="topic-main-info" onclick="goToTopicForum(${topic.topicId})">
                            <div class="topic-title-row">
                                <h3 class="topic-title">${escapeHtml(topic.title)}</h3>
                                ${isCreatorTopic ? '<span class="topic-badge required">ğŸ“Œ å¿…ç­”</span>' : ''}
                                ${isHot ? '<span class="topic-badge hot">ğŸ”¥ çƒ­é—¨</span>' : ''}
                                ${isFirstNonCreatorTopic ? '<span class="topic-badge new">âœ¨ æœ€æ–°</span>' : ''}
                            </div>
                            <p class="topic-description ${topic.description ? '' : 'empty'}">
                                ${topic.description ? escapeHtml(topic.description) : 'æš‚æ— è¯´æ˜ï¼Œç‚¹å‡»è¿›å…¥æŸ¥çœ‹è¯¦æƒ…'}
                            </p>
                        </div>
                        ${canManage ? `
                            <div class="topic-actions">
                                <button class="btn-topic-action btn-edit" onclick="event.stopPropagation(); editTopic(${topic.topicId})">
                                    <i class="fas fa-edit"></i>
                                    <span>ç¼–è¾‘</span>
                                </button>
                                <button class="btn-topic-action btn-delete" onclick="event.stopPropagation(); deleteTopic(${topic.topicId})">
                                    <i class="fas fa-trash-alt"></i>
                                    <span>åˆ é™¤</span>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                    <div class="topic-meta">
    <div class="topic-meta-item">
        <i class="fas fa-user-circle"></i>
        <span>å‘èµ·äººï¼š<strong>${escapeHtml(topic.creatorName || 'æœªçŸ¥')}</strong></span>
    </div>
    <div class="topic-meta-item">
        <i class="fas fa-comment-dots"></i>
        <span><strong>${topic.commentCount || 0}</strong> æ¡è®¨è®º</span>
    </div>
    <div class="topic-meta-item">
        <i class="fas fa-clock"></i>
        <span>${formatDate(topic.createdAt)}</span>
    </div>
</div>
                </div>
            `;
        }).join('');
    }

    // ========== æ‰“å¼€åˆ›å»ºè¯é¢˜æ¨¡æ€æ¡† ==========
    document.getElementById('btnCreateTopic').addEventListener('click', openCreateTopicModal);

    function openCreateTopicModal() {
        document.getElementById('modalTitle').textContent = 'å‘èµ·æ–°è¯é¢˜';
        document.getElementById('topicForm').reset();
        document.getElementById('editTopicId').value = '';
        document.getElementById('topicModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    // ========== å…³é—­æ¨¡æ€æ¡† ==========
    function closeTopicModal() {
        document.getElementById('topicModal').classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    // ========== æäº¤è¯é¢˜è¡¨å• ==========
    document.getElementById('topicForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const topicId = document.getElementById('editTopicId').value;
        const title = document.getElementById('topicTitle').value.trim();
        const description = document.getElementById('topicDescription').value.trim();
        const scaffold = document.getElementById('topicScaffold').value.trim();

        if (!title) {
            showMessage('è¯·è¾“å…¥è¯é¢˜æ ‡é¢˜', 'warning');
            return;
        }

        try {
            showMessage('æ­£åœ¨ä¿å­˜...', 'info');

            const topicData = {
    taskId: currentTaskId,
    title: title,
    content: description,      // âœ… ä¿®æ”¹ä¸º contentï¼ˆåç«¯APIè¦æ±‚çš„å­—æ®µåï¼‰
    scaffold: scaffold || null
};

            let result;
            if (topicId) {
                // ç¼–è¾‘è¯é¢˜
                result = await Topics.updateTopic(parseInt(topicId), topicData);
            } else {
                // åˆ›å»ºè¯é¢˜
                result = await Topics.createTopic(topicData);
            }

            if (result.success) {
                if (window.Utils && Utils.sendAnalyticsEvent) {
                    if (topicId) {
                        Utils.sendAnalyticsEvent('topic_edit', {
                            category: 'interaction',
                            target_type: 'topic',
                            target_id: parseInt(topicId),
                            club_id: currentClubId,
                            target_object: {
                                title: title,
                                content: description,
                                content_length: description.length
                            }
                        });
                    } else {
                        Utils.sendAnalyticsEvent('topic_create', {
                            category: 'interaction',
                            target_type: 'topic',
                            target_id: result.data?.topicId,
                            club_id: currentClubId,
                            target_object: {
                                title: title,
                                content: description,
                                content_length: description.length
                            }
                        });
                    }
                }
                showMessage(topicId ? 'è¯é¢˜æ›´æ–°æˆåŠŸ' : 'è¯é¢˜å‘å¸ƒæˆåŠŸï¼', 'success');
                closeTopicModal();
                await loadTopics();
            } else {
                showMessage(result.message || 'æ“ä½œå¤±è´¥', 'error');
            }
        } catch (error) {
            console.error('ä¿å­˜è¯é¢˜å¤±è´¥:', error);
            showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
        }
    });

    // ========== ç¼–è¾‘è¯é¢˜ ==========
    async function editTopic(topicId) {
        try {
            const topic = topicList.find(t => t.topicId === topicId);
            if (!topic) {
                showMessage('æ‰¾ä¸åˆ°è¯¥è¯é¢˜', 'error');
                return;
            }

            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è¯é¢˜';
            document.getElementById('editTopicId').value = topicId;
            document.getElementById('topicTitle').value = topic.title;
            document.getElementById('topicDescription').value = topic.content || topic.description || '';
            document.getElementById('topicScaffold').value = topic.scaffold || '';
            document.getElementById('topicModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        } catch (error) {
            console.error('ç¼–è¾‘è¯é¢˜å¤±è´¥:', error);
            showMessage('æ“ä½œå¤±è´¥', 'error');
        }
    }

    // ========== åˆ é™¤è¯é¢˜ ==========
    async function deleteTopic(topicId) {
    console.log('[DEBUG] ğŸ—‘ï¸ å¼€å§‹åˆ é™¤è¯é¢˜ï¼ŒID:', topicId);
    console.log('[DEBUG] ğŸ“‹ å½“å‰å…¨å±€ topicList æ•°é‡:', topicList.length);
    
    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯é¢˜å—ï¼Ÿåˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œæ‰€æœ‰ç›¸å…³è®¨è®ºä¹Ÿä¼šè¢«åˆ é™¤ã€‚')) {
        console.log('[DEBUG] âŒ ç”¨æˆ·å–æ¶ˆåˆ é™¤');
        return;
    }

    try {
        console.log('[DEBUG] ğŸ“¤ å‘é€åˆ é™¤è¯·æ±‚ï¼Œè¯é¢˜ID:', topicId);
        showMessage('æ­£åœ¨åˆ é™¤...', 'info');

        const result = await Topics.deleteTopic(topicId);
        
        console.log('[DEBUG] ğŸ“¥ åˆ é™¤è¯·æ±‚è¿”å›ç»“æœ:', result);
        
        if (result.success) {
            showMessage('è¯é¢˜åˆ é™¤æˆåŠŸ', 'success');
            
            console.log('[DEBUG] âœ… åˆ é™¤æˆåŠŸï¼Œå¼€å§‹é‡æ–°åŠ è½½è¯é¢˜åˆ—è¡¨');
            console.log('[DEBUG] ğŸ“‹ åˆ é™¤å‰å…¨å±€ topicList:', topicList.map(t => t.topicId));
            
            // â­ æ¸…ç©ºå½“å‰åˆ—è¡¨ï¼Œç«‹å³åé¦ˆ
            const oldTopicList = [...topicList]; // ä¿å­˜æ—§æ•°æ®ç”¨äºå¯¹æ¯”
            topicList = [];
            displayTopics([]); // ç«‹å³æ¸…ç©ºæ˜¾ç¤º
            
            // é‡æ–°åŠ è½½
            await loadTopics();
            
            console.log('[DEBUG] ğŸ“‹ é‡æ–°åŠ è½½åå…¨å±€ topicList:', topicList.map(t => t.topicId));
            
            // å¯¹æ¯”æ£€æŸ¥
            const stillExists = topicList.find(t => t.topicId === topicId);
            if (stillExists) {
                console.error('[DEBUG] âŒ è¯é¢˜ä»ç„¶å­˜åœ¨äºå…¨å±€å˜é‡ä¸­');
                console.error('[DEBUG] âŒ å®Œæ•´å¯¹æ¯”:');
                console.error('[DEBUG] âŒ æ—§åˆ—è¡¨:', oldTopicList.map(t => t.topicId));
                console.error('[DEBUG] âŒ æ–°åˆ—è¡¨:', topicList.map(t => t.topicId));
            } else {
                console.log('[DEBUG] âœ… ç¡®è®¤è¯é¢˜å·²ä»å…¨å±€å˜é‡ä¸­ç§»é™¤');
            }
        } else {
            console.log('[DEBUG] âŒ åˆ é™¤å¤±è´¥:', result.message);
            showMessage(result.message || 'åˆ é™¤å¤±è´¥', 'error');
        }
    } catch (error) {
        console.error('[DEBUG] âŒ åˆ é™¤è¯é¢˜å¼‚å¸¸:', error);
        showMessage('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
    }
}

    // ========== è·³è½¬åˆ°è¯é¢˜è®ºå› ==========
    function goToTopicForum(topicId) {
        if (window.Utils && Utils.sendAnalyticsEvent) {
            Utils.sendAnalyticsEvent('topic_open_detail', {
                category: 'interaction',
                target_type: 'topic',
                target_id: topicId
            });
        }
        window.location.hash = `topicforum?taskId=${currentTaskId}&topicId=${topicId}&clubId=${currentClubId}`;
    }

    // ========== è¿”å›ä»»åŠ¡é¡µ ==========
    function goBackToTasks() {
        const hash = `tasks?taskId=${currentTaskId}&clubId=${currentClubId}`;
        window.location.hash = hash;
    }

    // ========== å·¥å…·å‡½æ•° ==========
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatDate(dateString) {
        if (!dateString) return 'åˆšåˆš';
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        
        if (diff < 60000) return 'åˆšåˆš';
        if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
        if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
        if (diff < 2592000000) return Math.floor(diff / 86400000) + 'å¤©å‰';
        
        return date.toLocaleDateString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        });
    }

    function showMessage(message, type = 'info') {
        if (window.Utils && window.Utils.showNotification) {
            window.Utils.showNotification(message, type);
            return;
        }
        
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 24px;
            right: 24px;
            background: ${type === 'error' ? '#ff4d4f' : type === 'success' ? '#52c41a' : type === 'warning' ? '#faad14' : '#1890ff'};
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            z-index: 1000;
            font-size: 15px;
            font-weight: 500;
            max-width: 400px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
            border-left: 4px solid ${type === 'error' ? '#d9363e' : type === 'success' ? '#389e0d' : type === 'warning' ? '#d48806' : '#096dd9'};
        `;
        
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // ========== å…¨å±€å‡½æ•° ==========
    window.closeTopicModal = closeTopicModal;
    window.editTopic = editTopic;
    window.deleteTopic = deleteTopic;
    window.goToTopicForum = goToTopicForum;
    window.goBackToTasks = goBackToTasks;
    window.initTopicListPage = initTopicListPage;

    // ç«‹å³åˆå§‹åŒ–
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTopicListPage);
    } else {
        initTopicListPage();
    }
</script>

</body>
</html>
